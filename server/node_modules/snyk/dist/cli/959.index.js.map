{"version":3,"file":"959.index.js","mappings":"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","sources":["webpack://snyk/./src/lib/monitor/count-total-deps-in-tree.ts","webpack://snyk/./src/lib/monitor/drop-empty-deps.ts","webpack://snyk/./src/lib/monitor/filter-out-missing-deps.ts","webpack://snyk/./src/lib/monitor/index.ts","webpack://snyk/./src/lib/monitor/prune-dep-tree.ts","webpack://snyk/./src/lib/monitor/utils.ts","webpack://snyk/./src/lib/project-metadata/types.ts"],"sourcesContent":["import { DepTree } from '../types';\n\nexport function countTotalDependenciesInTree(depTree: DepTree): number {\n  let count = 0;\n  if (depTree.dependencies) {\n    for (const name of Object.keys(depTree.dependencies)) {\n      const dep = depTree.dependencies[name];\n      if (dep) {\n        count += 1 + countTotalDependenciesInTree(dep);\n      }\n    }\n  }\n  return count;\n}\n","import { DepTree } from '../types';\n\nexport function dropEmptyDeps(depTree: DepTree) {\n  if (depTree.dependencies) {\n    const keys = Object.keys(depTree.dependencies);\n    if (keys.length === 0) {\n      delete depTree.dependencies;\n    } else {\n      for (const k of keys) {\n        dropEmptyDeps(depTree.dependencies[k]);\n      }\n    }\n  }\n  return depTree;\n}\n","import { DepTree } from '../types';\n\ninterface FilteredDepTree {\n  filteredDepTree: DepTree;\n  missingDeps: string[];\n}\n\nexport function filterOutMissingDeps(depTree: DepTree): FilteredDepTree {\n  const filteredDeps = {};\n  const missingDeps: string[] = [];\n\n  if (!depTree.dependencies) {\n    return {\n      filteredDepTree: depTree,\n      missingDeps,\n    };\n  }\n\n  for (const depKey of Object.keys(depTree.dependencies)) {\n    const dep = depTree.dependencies[depKey];\n    if (\n      (dep as any).missingLockFileEntry ||\n      ((dep as any).labels && (dep as any).labels.missingLockFileEntry)\n    ) {\n      // TODO(kyegupov): add field to the type\n      missingDeps.push(`${dep.name}@${dep.version}`);\n    } else {\n      filteredDeps[depKey] = dep;\n    }\n  }\n  const filteredDepTree: DepTree = {\n    ...depTree,\n    dependencies: filteredDeps,\n  };\n\n  return {\n    filteredDepTree,\n    missingDeps,\n  };\n}\n","import * as Debug from 'debug';\nimport * as path from 'path';\n\nimport * as depGraphLib from '@snyk/dep-graph';\nimport * as snyk from '..';\nimport { apiOrOAuthTokenExists, getAuthHeader } from '../api-token';\nimport { makeRequest } from '../request';\nimport * as config from '../config';\nimport * as os from 'os';\nconst get = require('lodash.get');\nconst camelCase = require('lodash.camelcase');\nimport { isCI } from '../is-ci';\nimport * as analytics from '../analytics';\nimport {\n  DepTree,\n  MonitorMeta,\n  MonitorResult,\n  PolicyOptions,\n  MonitorOptions,\n  Options,\n  Contributor,\n} from '../types';\nimport * as projectMetadata from '../project-metadata';\n\nimport {\n  MonitorError,\n  ConnectionTimeoutError,\n  AuthFailedError,\n  FailedToRunTestError,\n} from '../errors';\nimport { pruneGraph } from '../prune';\nimport { GRAPH_SUPPORTED_PACKAGE_MANAGERS } from '../package-managers';\nimport { isFeatureFlagSupportedForOrg } from '../feature-flags';\nimport { countTotalDependenciesInTree } from './count-total-deps-in-tree';\nimport { filterOutMissingDeps } from './filter-out-missing-deps';\nimport { dropEmptyDeps } from './drop-empty-deps';\nimport { pruneTree } from './prune-dep-tree';\nimport { findAndLoadPolicy } from '../policy';\nimport { PluginMetadata } from '@snyk/cli-interface/legacy/plugin';\nimport {\n  CallGraph,\n  CallGraphError,\n  ScannedProject,\n} from '@snyk/cli-interface/legacy/common';\nimport { isGitTarget } from '../project-metadata/types';\nimport { serializeCallGraphWithMetrics } from '../reachable-vulns';\nimport {\n  getNameDepTree,\n  getNameDepGraph,\n  getProjectName,\n  getTargetFile,\n} from './utils';\nimport { countPathsToGraphRoot } from '../utils';\nimport * as alerts from '../alerts';\nimport { abridgeErrorMessage } from '../error-format';\n\nconst debug = Debug('snyk');\n\nconst ANALYTICS_PAYLOAD_MAX_LENGTH = 1024;\n\n// TODO(kyegupov): clean up the type, move to snyk-cli-interface repository\n\ninterface MonitorBody {\n  meta: Meta;\n  policy: string;\n  package?: DepTree;\n  callGraph?: CallGraph;\n  target: {};\n  targetFileRelativePath: string;\n  targetFile: string;\n  contributors?: Contributor[];\n}\n\ninterface Meta {\n  method?: string;\n  hostname: string;\n  id: string;\n  ci: boolean;\n  pid: number;\n  node: string;\n  master: boolean;\n  name: string;\n  version: string;\n  org?: string;\n  pluginName: string;\n  pluginRuntime: string;\n  dockerImageId?: string;\n  dockerBaseImage?: string;\n  projectName: string;\n}\n\nexport async function monitor(\n  root: string,\n  meta: MonitorMeta,\n  scannedProject: ScannedProject,\n  options: Options & MonitorOptions & PolicyOptions,\n  pluginMeta: PluginMetadata,\n  targetFileRelativePath?: string,\n  contributors?: Contributor[],\n): Promise<MonitorResult> {\n  apiOrOAuthTokenExists();\n\n  const packageManager = meta.packageManager;\n  analytics.add('packageManager', packageManager);\n  analytics.add('isDocker', !!meta.isDocker);\n\n  if (scannedProject.depGraph) {\n    return await monitorDepGraph(\n      root,\n      meta,\n      scannedProject,\n      pluginMeta,\n      options,\n      targetFileRelativePath,\n      contributors,\n    );\n  }\n\n  // TODO @boost: delete this once 'experimental-dep-graph' ff is deleted\n  if (GRAPH_SUPPORTED_PACKAGE_MANAGERS.includes(packageManager)) {\n    const monitorGraphSupportedRes = await isFeatureFlagSupportedForOrg(\n      camelCase('experimental-dep-graph'),\n      options.org || config.org,\n    );\n\n    if (monitorGraphSupportedRes.code === 401) {\n      throw AuthFailedError(\n        monitorGraphSupportedRes.error,\n        monitorGraphSupportedRes.code,\n      );\n    }\n    if (monitorGraphSupportedRes.ok) {\n      return await experimentalMonitorDepGraphFromDepTree(\n        root,\n        meta,\n        scannedProject,\n        pluginMeta,\n        options,\n        targetFileRelativePath,\n        contributors,\n      );\n    }\n    if (monitorGraphSupportedRes.userMessage) {\n      debug(monitorGraphSupportedRes.userMessage);\n    }\n  }\n\n  return await monitorDepTree(\n    root,\n    meta,\n    scannedProject,\n    pluginMeta,\n    options,\n    targetFileRelativePath,\n    contributors,\n  );\n}\n\nasync function monitorDepTree(\n  root: string,\n  meta: MonitorMeta,\n  scannedProject: ScannedProject,\n  pluginMeta: PluginMetadata,\n  options: MonitorOptions & PolicyOptions,\n  targetFileRelativePath?: string,\n  contributors?: Contributor[],\n): Promise<MonitorResult> {\n  let treeMissingDeps: string[] = [];\n\n  const packageManager = meta.packageManager;\n\n  let depTree = scannedProject.depTree;\n\n  if (!depTree) {\n    debug(\n      'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n    );\n    throw new FailedToRunTestError(\n      'Your monitor request could not be completed. Please email support@snyk.io',\n    );\n  }\n\n  let prePruneDepCount;\n  if (meta.prune) {\n    debug('prune used, counting total dependencies');\n    prePruneDepCount = countTotalDependenciesInTree(depTree);\n    analytics.add('prePruneDepCount', prePruneDepCount);\n    debug('total dependencies: %d', prePruneDepCount);\n    debug('pruning dep tree');\n    depTree = await pruneTree(depTree, meta.packageManager);\n    debug('finished pruning dep tree');\n  }\n  if (['npm', 'yarn'].includes(meta.packageManager)) {\n    const { filteredDepTree, missingDeps } = filterOutMissingDeps(depTree);\n    depTree = filteredDepTree;\n    treeMissingDeps = missingDeps;\n  }\n\n  let targetFileDir;\n\n  if (targetFileRelativePath) {\n    const { dir } = path.parse(targetFileRelativePath);\n    targetFileDir = dir;\n  }\n\n  const policy = await findAndLoadPolicy(\n    root,\n    meta.isDocker ? 'docker' : packageManager!,\n    options,\n    // TODO: fix this and send only send when we used resolve-deps for node\n    // it should be a ExpandedPkgTree type instead\n    depTree,\n    targetFileDir,\n  );\n\n  const target = await projectMetadata.getInfo(scannedProject, meta, depTree);\n\n  if (isGitTarget(target) && target.branch) {\n    analytics.add('targetBranch', target.branch);\n  }\n\n  depTree = dropEmptyDeps(depTree);\n\n  let callGraphPayload;\n  if (\n    options.reachableVulns &&\n    (scannedProject.callGraph as CallGraphError)?.innerError\n  ) {\n    const err = scannedProject.callGraph as CallGraphError;\n    analytics.add(\n      'callGraphError',\n      abridgeErrorMessage(\n        err.innerError.toString(),\n        ANALYTICS_PAYLOAD_MAX_LENGTH,\n      ),\n    );\n    alerts.registerAlerts([\n      {\n        type: 'error',\n        name: 'missing-call-graph',\n        msg: err.message,\n      },\n    ]);\n  } else if (scannedProject.callGraph) {\n    const { callGraph, nodeCount, edgeCount } = serializeCallGraphWithMetrics(\n      scannedProject.callGraph as CallGraph,\n    );\n    debug(\n      `Adding call graph to payload, node count: ${nodeCount}, edge count: ${edgeCount}`,\n    );\n\n    const callGraphMetrics = get(pluginMeta, 'meta.callGraphMetrics', {});\n    analytics.add('callGraphMetrics', {\n      callGraphEdgeCount: edgeCount,\n      callGraphNodeCount: nodeCount,\n      ...callGraphMetrics,\n    });\n    callGraphPayload = callGraph;\n  }\n\n  // TODO(kyegupov): async/await\n  return new Promise((resolve, reject) => {\n    if (!depTree) {\n      debug(\n        'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n      );\n      return reject(\n        new FailedToRunTestError(\n          'Your monitor request could not be completed. Please email support@snyk.io',\n        ),\n      );\n    }\n    makeRequest(\n      {\n        body: {\n          meta: {\n            method: meta.method,\n            hostname: os.hostname(),\n            id: snyk.id || depTree.name,\n            ci: isCI(),\n            pid: process.pid,\n            node: process.version,\n            master: snyk.config.isMaster,\n            name: getNameDepTree(scannedProject, depTree, meta),\n            version: depTree.version,\n            org: config.org ? decodeURIComponent(config.org) : undefined,\n            pluginName: pluginMeta.name,\n            pluginRuntime: pluginMeta.runtime,\n            missingDeps: treeMissingDeps,\n            dockerImageId: pluginMeta.dockerImageId,\n            dockerBaseImage: depTree.docker\n              ? depTree.docker.baseImage\n              : undefined,\n            dockerfileLayers: depTree.docker\n              ? depTree.docker.dockerfileLayers\n              : undefined,\n            projectName: getProjectName(scannedProject, meta),\n            prePruneDepCount, // undefined unless 'prune' is used,\n            monitorGraph: false,\n            versionBuildInfo: JSON.stringify(\n              scannedProject.meta?.versionBuildInfo,\n            ),\n            gradleProjectName: scannedProject.meta?.gradleProjectName,\n            platform: scannedProject.meta?.platform,\n          },\n          policy: policy ? policy.toString() : undefined,\n          package: depTree,\n          callGraph: callGraphPayload,\n          // we take the targetFile from the plugin,\n          // because we want to send it only for specific package-managers\n          target,\n          // WARNING: be careful changing this as it affects project uniqueness\n          targetFile: getTargetFile(scannedProject, pluginMeta),\n          targetFileRelativePath,\n          contributors,\n        } as MonitorBody,\n        gzip: true,\n        method: 'PUT',\n        headers: {\n          authorization: getAuthHeader(),\n          'content-encoding': 'gzip',\n        },\n        url: config.API + '/monitor/' + packageManager,\n        json: true,\n      },\n      (error, res, body) => {\n        if (error) {\n          return reject(error);\n        }\n\n        if (res.statusCode >= 200 && res.statusCode <= 299) {\n          resolve(body as MonitorResult);\n        } else {\n          let err;\n          const userMessage = body && body.userMessage;\n          if (!userMessage && res.statusCode === 504) {\n            err = new ConnectionTimeoutError();\n          } else {\n            err = new MonitorError(res.statusCode, userMessage);\n          }\n          reject(err);\n        }\n      },\n    );\n  });\n}\n\nexport async function monitorDepGraph(\n  root: string,\n  meta: MonitorMeta,\n  scannedProject: ScannedProject,\n  pluginMeta: PluginMetadata,\n  options: MonitorOptions & PolicyOptions,\n  targetFileRelativePath?: string,\n  contributors?: Contributor[],\n): Promise<MonitorResult> {\n  const packageManager = meta.packageManager;\n  analytics.add('monitorDepGraph', true);\n\n  let depGraph = scannedProject.depGraph;\n\n  if (!depGraph) {\n    debug(\n      'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n    );\n    throw new FailedToRunTestError(\n      'Your monitor request could not be completed. Please email support@snyk.io',\n    );\n  }\n\n  let targetFileDir;\n\n  if (targetFileRelativePath) {\n    const { dir } = path.parse(targetFileRelativePath);\n    targetFileDir = dir;\n  }\n\n  const policy = await findAndLoadPolicy(\n    root,\n    meta.isDocker ? 'docker' : packageManager!,\n    options,\n    undefined,\n    targetFileDir,\n  );\n\n  const target = await projectMetadata.getInfo(scannedProject, meta);\n  if (isGitTarget(target) && target.branch) {\n    analytics.add('targetBranch', target.branch);\n  }\n\n  const pruneIsRequired = options.pruneRepeatedSubdependencies;\n  depGraph = await pruneGraph(depGraph, packageManager, pruneIsRequired);\n\n  let callGraphPayload;\n  if (\n    options.reachableVulns &&\n    (scannedProject.callGraph as CallGraphError)?.innerError\n  ) {\n    const err = scannedProject.callGraph as CallGraphError;\n    analytics.add(\n      'callGraphError',\n      abridgeErrorMessage(\n        err.innerError.toString(),\n        ANALYTICS_PAYLOAD_MAX_LENGTH,\n      ),\n    );\n    alerts.registerAlerts([\n      {\n        type: 'error',\n        name: 'missing-call-graph',\n        msg: err.message,\n      },\n    ]);\n  } else if (scannedProject.callGraph) {\n    const { callGraph, nodeCount, edgeCount } = serializeCallGraphWithMetrics(\n      scannedProject.callGraph as CallGraph,\n    );\n    debug(\n      `Adding call graph to payload, node count: ${nodeCount}, edge count: ${edgeCount}`,\n    );\n\n    const callGraphMetrics = get(pluginMeta, 'meta.callGraphMetrics', {});\n    analytics.add('callGraphMetrics', {\n      callGraphEdgeCount: edgeCount,\n      callGraphNodeCount: nodeCount,\n      ...callGraphMetrics,\n    });\n    callGraphPayload = callGraph;\n  }\n\n  return new Promise((resolve, reject) => {\n    if (!depGraph) {\n      debug(\n        'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n      );\n      return reject(\n        new FailedToRunTestError(\n          'Your monitor request could not be completed. Please email support@snyk.io',\n        ),\n      );\n    }\n    makeRequest(\n      {\n        body: {\n          meta: {\n            method: meta.method,\n            hostname: os.hostname(),\n            id: snyk.id || depGraph.rootPkg.name,\n            ci: isCI(),\n            pid: process.pid,\n            node: process.version,\n            master: snyk.config.isMaster,\n            name: getNameDepGraph(scannedProject, depGraph, meta),\n            version: depGraph.rootPkg.version,\n            org: config.org ? decodeURIComponent(config.org) : undefined,\n            pluginName: pluginMeta.name,\n            pluginRuntime: pluginMeta.runtime,\n            projectName: getProjectName(scannedProject, meta),\n            monitorGraph: true,\n            versionBuildInfo: JSON.stringify(\n              scannedProject.meta?.versionBuildInfo,\n            ),\n            gradleProjectName: scannedProject.meta?.gradleProjectName,\n          },\n          policy: policy ? policy.toString() : undefined,\n          depGraphJSON: depGraph, // depGraph will be auto serialized to JSON on send\n          // we take the targetFile from the plugin,\n          // because we want to send it only for specific package-managers\n          target,\n          targetFile: getTargetFile(scannedProject, pluginMeta),\n          targetFileRelativePath,\n          contributors,\n          callGraph: callGraphPayload,\n        } as MonitorBody,\n        gzip: true,\n        method: 'PUT',\n        headers: {\n          authorization: getAuthHeader(),\n          'content-encoding': 'gzip',\n        },\n        url: `${config.API}/monitor/${packageManager}/graph`,\n        json: true,\n      },\n      (error, res, body) => {\n        if (error) {\n          return reject(error);\n        }\n        if (res.statusCode >= 200 && res.statusCode <= 299) {\n          resolve(body as MonitorResult);\n        } else {\n          let err;\n          const userMessage = body && body.userMessage;\n          if (!userMessage && res.statusCode === 504) {\n            err = new ConnectionTimeoutError();\n          } else {\n            err = new MonitorError(res.statusCode, userMessage);\n          }\n          reject(err);\n        }\n      },\n    );\n  });\n}\n\n/**\n * @deprecated it will be deleted once experimentalDepGraph FF will be deleted\n * and npm, yarn, sbt and rubygems usage of `experimentalMonitorDepGraphFromDepTree`\n * will be replaced with `monitorDepGraph` method\n */\nasync function experimentalMonitorDepGraphFromDepTree(\n  root: string,\n  meta: MonitorMeta,\n  scannedProject: ScannedProject,\n  pluginMeta: PluginMetadata,\n  options: MonitorOptions & PolicyOptions,\n  targetFileRelativePath?: string,\n  contributors?: Contributor[],\n): Promise<MonitorResult> {\n  const packageManager = meta.packageManager;\n  analytics.add('experimentalMonitorDepGraphFromDepTree', true);\n\n  let treeMissingDeps: string[];\n  let depTree = scannedProject.depTree;\n\n  if (!depTree) {\n    debug(\n      'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n    );\n    throw new FailedToRunTestError(\n      'Your monitor request could not be completed. Please email support@snyk.io',\n    );\n  }\n\n  let targetFileDir;\n\n  if (targetFileRelativePath) {\n    const { dir } = path.parse(targetFileRelativePath);\n    targetFileDir = dir;\n  }\n\n  const policy = await findAndLoadPolicy(\n    root,\n    meta.isDocker ? 'docker' : packageManager!,\n    options,\n    // TODO: fix this and send only send when we used resolve-deps for node\n    // it should be a ExpandedPkgTree type instead\n    depTree,\n    targetFileDir,\n  );\n\n  if (['npm', 'yarn'].includes(meta.packageManager)) {\n    const { filteredDepTree, missingDeps } = filterOutMissingDeps(depTree);\n    depTree = filteredDepTree;\n    treeMissingDeps = missingDeps;\n  }\n\n  const depGraph: depGraphLib.DepGraph = await depGraphLib.legacy.depTreeToGraph(\n    depTree,\n    packageManager,\n  );\n  const target = await projectMetadata.getInfo(scannedProject, meta, depTree);\n\n  if (isGitTarget(target) && target.branch) {\n    analytics.add('targetBranch', target.branch);\n  }\n\n  let prunedGraph = depGraph;\n  let prePruneDepCount;\n  if (meta.prune) {\n    debug('Trying to prune the graph');\n    prePruneDepCount = countPathsToGraphRoot(depGraph);\n    debug('pre prunedPathsCount: ' + prePruneDepCount);\n    prunedGraph = await pruneGraph(depGraph, packageManager, meta.prune);\n  }\n\n  return new Promise((resolve, reject) => {\n    if (!depTree) {\n      debug(\n        'scannedProject is missing depGraph or depTree, cannot run test/monitor',\n      );\n      return reject(\n        new FailedToRunTestError(\n          'Your monitor request could not be completed. Please email support@snyk.io',\n        ),\n      );\n    }\n    makeRequest(\n      {\n        body: {\n          meta: {\n            method: meta.method,\n            hostname: os.hostname(),\n            id: snyk.id || depTree.name,\n            ci: isCI(),\n            pid: process.pid,\n            node: process.version,\n            master: snyk.config.isMaster,\n            name: getNameDepGraph(scannedProject, depGraph, meta),\n            version: depGraph.rootPkg.version,\n            org: config.org ? decodeURIComponent(config.org) : undefined,\n            pluginName: pluginMeta.name,\n            pluginRuntime: pluginMeta.runtime,\n            dockerImageId: pluginMeta.dockerImageId,\n            dockerBaseImage: depTree.docker\n              ? depTree.docker.baseImage\n              : undefined,\n            dockerfileLayers: depTree.docker\n              ? depTree.docker.dockerfileLayers\n              : undefined,\n            projectName: getProjectName(scannedProject, meta),\n            prePruneDepCount, // undefined unless 'prune' is used\n            missingDeps: treeMissingDeps,\n            monitorGraph: true,\n          },\n          policy: policy ? policy.toString() : undefined,\n          depGraphJSON: prunedGraph, // depGraph will be auto serialized to JSON on send\n          // we take the targetFile from the plugin,\n          // because we want to send it only for specific package-managers\n          target,\n          targetFile: getTargetFile(scannedProject, pluginMeta),\n          targetFileRelativePath,\n          contributors,\n        } as MonitorBody,\n        gzip: true,\n        method: 'PUT',\n        headers: {\n          authorization: getAuthHeader(),\n          'content-encoding': 'gzip',\n        },\n        url: `${config.API}/monitor/${packageManager}/graph`,\n        json: true,\n      },\n      (error, res, body) => {\n        if (error) {\n          return reject(error);\n        }\n\n        if (res.statusCode >= 200 && res.statusCode <= 299) {\n          resolve(body as MonitorResult);\n        } else {\n          let err;\n          const userMessage = body && body.userMessage;\n          if (!userMessage && res.statusCode === 504) {\n            err = new ConnectionTimeoutError();\n          } else {\n            err = new MonitorError(res.statusCode, userMessage);\n          }\n          reject(err);\n        }\n      },\n    );\n  });\n}\n","import * as depGraphLib from '@snyk/dep-graph';\nimport { DepTree } from '../types';\n\nexport async function pruneTree(\n  tree: DepTree,\n  packageManagerName: string,\n): Promise<DepTree> {\n  // Pruning requires conversion to the graph first.\n  // This is slow.\n  const graph = await depGraphLib.legacy.depTreeToGraph(\n    tree,\n    packageManagerName,\n  );\n  const prunedTree: DepTree = (await depGraphLib.legacy.graphToDepTree(\n    graph,\n    packageManagerName,\n    { deduplicateWithinTopLevelDeps: true },\n  )) as DepTree;\n  // Transplant pruned dependencies in the original tree (we want to keep all other fields):\n  tree.dependencies = prunedTree.dependencies;\n  return tree;\n}\n","import { ScannedProject, DepTree } from '@snyk/cli-interface/legacy/common';\nimport {\n  getContainerTargetFile,\n  getContainerProjectName,\n  getContainerName,\n  isContainer,\n} from '../container';\nimport * as depGraphLib from '@snyk/dep-graph';\nimport { MonitorMeta } from '../types';\nimport { PluginMetadata } from '@snyk/cli-interface/legacy/plugin';\n\nexport function getNameDepTree(\n  scannedProject: ScannedProject,\n  depTree: DepTree,\n  meta: MonitorMeta,\n): string | undefined {\n  if (isContainer(scannedProject)) {\n    return getContainerName(scannedProject, meta);\n  }\n  return depTree.name;\n}\n\nexport function getNameDepGraph(\n  scannedProject: ScannedProject,\n  depGraph: depGraphLib.DepGraph,\n  meta: MonitorMeta,\n): string | undefined {\n  if (isContainer(scannedProject)) {\n    return getContainerName(scannedProject, meta);\n  }\n  return depGraph.rootPkg?.name;\n}\n\nexport function getProjectName(\n  scannedProject: ScannedProject,\n  meta: MonitorMeta,\n): string | undefined {\n  if (isContainer(scannedProject)) {\n    return getContainerProjectName(scannedProject, meta);\n  }\n\n  if (meta['project-name'] && scannedProject.meta?.projectName) {\n    return scannedProject.meta.projectName;\n  }\n\n  return meta['project-name'];\n}\n\nexport function getTargetFile(\n  scannedProject: ScannedProject,\n  pluginMeta: PluginMetadata,\n): string | undefined {\n  if (isContainer(scannedProject)) {\n    return getContainerTargetFile(scannedProject);\n  }\n  return pluginMeta.targetFile;\n}\n","export interface GitTarget {\n  remoteUrl?: string;\n  branch?: string;\n}\n\nexport interface ContainerTarget {\n  image?: string;\n}\n\nexport function isGitTarget(target: any): target is GitTarget {\n  return target && (target.branch || target.remoteUrl);\n}\n"],"names":[],"sourceRoot":""}